// HashMap Operations
// Demonstrates HashMap<K, V> and the Entry API

use std::collections::HashMap;
use std::io::{self, Write};

fn main() {
    println!("=== HashMap Operations ===\n");
    
    loop {
        println!("\nChoose a demonstration:");
        println!("1. Phone Book");
        println!("2. Word Frequency Counter");
        println!("3. Student Grades");
        println!("4. Inventory System");
        println!("5. Entry API Demo");
        println!("6. Exit");
        print!("\nYour choice: ");
        io::stdout().flush().unwrap();
        
        let choice = read_number();
        
        match choice {
            1 => phone_book(),
            2 => word_frequency(),
            3 => student_grades(),
            4 => inventory_system(),
            5 => entry_api_demo(),
            6 => {
                println!("\nGoodbye!");
                break;
            }
            _ => println!("Invalid choice!"),
        }
    }
}

fn phone_book() {
    println!("\n=== Phone Book ===");
    let mut phone_book: HashMap<String, String> = HashMap::new();
    
    loop {
        println!("\n1. Add contact");
        println!("2. Find contact");
        println!("3. Update contact");
        println!("4. Delete contact");
        println!("5. List all contacts");
        println!("6. Back");
        print!("\nChoice: ");
        io::stdout().flush().unwrap();
        
        let choice = read_number();
        
        match choice {
            1 => {
                print!("Enter name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                print!("Enter phone number: ");
                io::stdout().flush().unwrap();
                let phone = read_string();
                
                phone_book.insert(name.clone(), phone);
                println!("âœ… Added contact: {}", name);
            }
            2 => {
                print!("Enter name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                match phone_book.get(&name) {
                    Some(phone) => println!("ğŸ“ {}: {}", name, phone),
                    None => println!("âŒ Contact not found"),
                }
            }
            3 => {
                print!("Enter name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                if !phone_book.contains_key(&name) {
                    println!("âŒ Contact not found");
                    continue;
                }
                
                print!("Enter new phone number: ");
                io::stdout().flush().unwrap();
                let phone = read_string();
                
                phone_book.insert(name.clone(), phone);
                println!("âœ… Updated contact: {}", name);
            }
            4 => {
                print!("Enter name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                if phone_book.remove(&name).is_some() {
                    println!("âœ… Deleted contact: {}", name);
                } else {
                    println!("âŒ Contact not found");
                }
            }
            5 => {
                if phone_book.is_empty() {
                    println!("\nğŸ“• Phone book is empty");
                } else {
                    println!("\nğŸ“• Contacts ({}):", phone_book.len());
                    let mut contacts: Vec<_> = phone_book.iter().collect();
                    contacts.sort_by_key(|(name, _)| name.as_str());
                    
                    for (name, phone) in contacts {
                        println!("   {} â†’ {}", name, phone);
                    }
                }
            }
            6 => break,
            _ => println!("Invalid choice!"),
        }
    }
}

fn word_frequency() {
    println!("\n=== Word Frequency Counter ===");
    println!("Enter text (press Enter twice to finish):");
    
    let mut lines = Vec::new();
    loop {
        let mut line = String::new();
        io::stdin().read_line(&mut line).unwrap();
        
        if line.trim().is_empty() {
            break;
        }
        lines.push(line);
    }
    
    let text = lines.join(" ");
    
    if text.trim().is_empty() {
        println!("No text entered!");
        return;
    }
    
    // Count word frequency
    let mut word_count: HashMap<String, usize> = HashMap::new();
    
    for word in text.split_whitespace() {
        let word = word
            .to_lowercase()
            .trim_matches(|c: char| !c.is_alphanumeric())
            .to_string();
        
        if !word.is_empty() {
            *word_count.entry(word).or_insert(0) += 1;
        }
    }
    
    // Display results
    println!("\nğŸ“Š Word Frequency:");
    println!("   Total words: {}", text.split_whitespace().count());
    println!("   Unique words: {}", word_count.len());
    
    // Sort by frequency
    let mut freq_vec: Vec<_> = word_count.iter().collect();
    freq_vec.sort_by(|a, b| b.1.cmp(a.1).then_with(|| a.0.cmp(b.0)));
    
    println!("\nğŸ” Top 10 words:");
    for (i, (word, count)) in freq_vec.iter().take(10).enumerate() {
        println!("   {}. '{}': {} times", i + 1, word, count);
    }
    
    // Character frequency
    let mut char_count: HashMap<char, usize> = HashMap::new();
    for ch in text.chars() {
        if ch.is_alphabetic() {
            *char_count.entry(ch.to_lowercase().next().unwrap()).or_insert(0) += 1;
        }
    }
    
    println!("\nğŸ”¤ Character frequency:");
    let mut char_vec: Vec<_> = char_count.iter().collect();
    char_vec.sort_by(|a, b| b.1.cmp(a.1));
    
    for (ch, count) in char_vec.iter().take(10) {
        println!("   '{}': {}", ch, count);
    }
}

fn student_grades() {
    println!("\n=== Student Grades ===");
    let mut grades: HashMap<String, Vec<i32>> = HashMap::new();
    
    loop {
        println!("\n1. Add student");
        println!("2. Add grade");
        println!("3. View student");
        println!("4. Class statistics");
        println!("5. Back");
        print!("\nChoice: ");
        io::stdout().flush().unwrap();
        
        let choice = read_number();
        
        match choice {
            1 => {
                print!("Enter student name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                grades.entry(name.clone()).or_insert_with(Vec::new);
                println!("âœ… Added student: {}", name);
            }
            2 => {
                print!("Enter student name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                print!("Enter grade (0-100): ");
                io::stdout().flush().unwrap();
                let grade = read_number();
                
                if grade < 0 || grade > 100 {
                    println!("âŒ Invalid grade!");
                    continue;
                }
                
                grades.entry(name.clone())
                    .or_insert_with(Vec::new)
                    .push(grade);
                println!("âœ… Added grade {} for {}", grade, name);
            }
            3 => {
                print!("Enter student name: ");
                io::stdout().flush().unwrap();
                let name = read_string();
                
                match grades.get(&name) {
                    Some(student_grades) if !student_grades.is_empty() => {
                        let avg = student_grades.iter().sum::<i32>() as f64 
                            / student_grades.len() as f64;
                        println!("\nğŸ“š {}", name);
                        println!("   Grades: {:?}", student_grades);
                        println!("   Average: {:.2}", avg);
                        println!("   Count: {}", student_grades.len());
                    }
                    Some(_) => println!("âŒ No grades recorded for {}", name),
                    None => println!("âŒ Student not found"),
                }
            }
            4 => {
                if grades.is_empty() {
                    println!("\nâŒ No students in database");
                    continue;
                }
                
                println!("\nğŸ“Š Class Statistics:");
                println!("   Total students: {}", grades.len());
                
                let mut all_grades = Vec::new();
                for student_grades in grades.values() {
                    all_grades.extend(student_grades);
                }
                
                if !all_grades.is_empty() {
                    let avg = all_grades.iter().sum::<i32>() as f64 / all_grades.len() as f64;
                    println!("   Total grades: {}", all_grades.len());
                    println!("   Class average: {:.2}", avg);
                    
                    // Top students
                    let mut student_avgs: Vec<_> = grades.iter()
                        .filter(|(_, g)| !g.is_empty())
                        .map(|(name, g)| {
                            let avg = g.iter().sum::<i32>() as f64 / g.len() as f64;
                            (name, avg)
                        })
                        .collect();
                    student_avgs.sort_by(|a, b| b.1.partial_cmp(&a.1).unwrap());
                    
                    println!("\nğŸ† Top students:");
                    for (i, (name, avg)) in student_avgs.iter().take(5).enumerate() {
                        println!("   {}. {}: {:.2}", i + 1, name, avg);
                    }
                }
            }
            5 => break,
            _ => println!("Invalid choice!"),
        }
    }
}


}
